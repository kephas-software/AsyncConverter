using AsyncConverter.Checkers;
using AsyncConverter.Settings;
using JetBrains.Application.Settings;
using JetBrains.ProjectModel;
using JetBrains.ReSharper.Psi.CSharp.Tree;
using JetBrains.ReSharper.Psi.Tree;

namespace AsyncConverter.AsyncHelpers.RenameCheckers
{
    [SolutionComponent]
    internal class TestRenameChecker : IConcreateRenameChecker
    {
        private readonly IUnderTestChecker underTestChecker;

        public TestRenameChecker(IUnderTestChecker underTestChecker)
        {
            this.underTestChecker = underTestChecker;
        }

        public bool SkipRename(IMethodDeclaration methodDeclaration)
        {
            var excludeTestMethods = methodDeclaration.GetSettingsStore().GetValue(AsyncConverterSettingsAccessor.ExcludeTestMethodsFromRenaming);
            return excludeTestMethods
                   && underTestChecker.IsUnder(methodDeclaration);
        }
    }
}